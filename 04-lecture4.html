<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>lecture4</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="04-lecture4_files/libs/clipboard/clipboard.min.js"></script>
<script src="04-lecture4_files/libs/quarto-html/quarto.js"></script>
<script src="04-lecture4_files/libs/quarto-html/popper.min.js"></script>
<script src="04-lecture4_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="04-lecture4_files/libs/quarto-html/anchor.min.js"></script>
<link href="04-lecture4_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="04-lecture4_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="04-lecture4_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="04-lecture4_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="04-lecture4_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="04-lecture4_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="04-lecture4_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<section id="random-variables" class="level1">
<h1>Random Variables</h1>
<p>Random variables are the main mathematical tool that allows us to quantify and analyze uncertainty in Finance for complex portfolios and other financial contexts like risk management. In all of these contexts random variables provide the foundation for probabilistic reasoning.</p>
<p>Throughout the previous lectures, we have encountered concepts such as conditional probabilities, dependencies, and independence. These ideas have helped us build intuition for modeling uncertainty. However, as we move into more advanced applications like portfolio risk modeling and asset price dynamics, a more explicit and formal treatment of <strong>random variables</strong> becomes unavoidable.</p>
<p>Random variables are at the core of probability theory, serving as a bridge between real-world phenomena and mathematical models. They allow us to represent uncertain outcomes numerically and provide a framework for analyzing those outcomes using tools such as <strong>expected value</strong>, <strong>variance</strong>, and <strong>covariance</strong>. These measures are indispensable for understanding and managing financial risk. Random variables play a vital role in applications like:</p>
<ul>
<li><strong>Portfolio Management</strong>: Estimating the expected return and risk of a portfolio.</li>
<li><strong>Risk Assessment</strong>: Modeling the probability of extreme events, such as market crashes.</li>
<li><strong>Asset Pricing</strong>: Understanding how prices evolve over time using models like the binomial tree.</li>
</ul>
<p>By the end of this lecture, you will:</p>
<ol type="1">
<li>Understand the definition and properties of random variables.</li>
<li>Learn how to compute and interpret expected value, variance, and covariance.</li>
<li>Apply R programming to simulate random variables and to construct a binomial tree to model asset price dynamics.</li>
</ol>
<section id="random-variables-and-distributions" class="level2">
<h2 class="anchored" data-anchor-id="random-variables-and-distributions">Random Variables and Distributions</h2>
<p>A <strong>random variable</strong> is a numerical outcome of a random phenomenon. Formally, a random variable is a function that assigns a real number to each outcome in the sample space of a random experiment. More explicitly:</p>
<div id="random-variable" class="callout callout-style-default callout-tip callout-titled" title="Definition: Random Variable">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Definition: Random Variable
</div>
</div>
<div class="callout-body-container callout-body">
<p>A <strong>random variable</strong> <span class="math inline">\(X\)</span> is a function <span class="math inline">\(X:\mathcal{S} \to \mathbb{R}\)</span> from the sample space (the set of all possible outcomes of the random experiment) to the real numbers.</p>
</div>
</div>
<p>A random variable is thus a <strong>function</strong> defined on the sample space of a random experiment. This formal definition allows us to generalize and analyze a wide variety of real-world scenarios. For instance:</p>
<ul>
<li>In the coin-flipping example from Lecture 2, the number of heads in 10 flips was a random variable.</li>
<li>The number of multiple brithdays in a group of <span class="math inline">\(n\)</span> people is also an example of a random variable.</li>
</ul>
<p>By explicitly recognizing these as random variables, we can now apply a systematic framework to quantify their behavior and analyze them.</p>
<p>Note that it is a widely held convention in probability theory to use capital letters such as <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> etc. as symbols of a random variable.</p>
<p>Random variables come in two varieties, depending on the properties of the sample space <span class="math inline">\({\cal S}\)</span>. If the sample space is a finite or countably finite set, the sample space is discrete and we talk of a <strong>discrete random variables</strong>.</p>
<p>Sometimes it is natural to consider continuous sample spaces. For example when we consider the return of an asset over a year or the price of a stock at a specific time. In this case we call a random variable <strong>continuous</strong>. With continuous sample spaces we will need tools from calculus. We will discuss continuous random variables in the next lecture. Here we stick with the concept of a discrete random variable.</p>
<p>In the case of a discrete sample space we can theoretically tabulate and random variable <span class="math inline">\(X\)</span> by enumerating in some order all points in the sample space and associating with each the corresponding value of <span class="math inline">\(X\)</span>.</p>
</section>
<section id="probability-distributions-and-cumulative-probability-distributions" class="level2">
<h2 class="anchored" data-anchor-id="probability-distributions-and-cumulative-probability-distributions">Probability Distributions and Cumulative Probability Distributions</h2>
<p>A random variable is characterized by its <strong>probability distribution</strong>, which describes how probabilities are assigned to its possible values.</p>
<div id="pmf-discrete" class="callout callout-style-default callout-tip callout-titled" title="Definition: Probability Mass Function of a Discrete Random Variable">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Definition: Probability Mass Function of a Discrete Random Variable
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let <span class="math inline">\(X\)</span> be a random variable and <span class="math inline">\(x_1, x_2, ...\)</span> the values which it assumes. The aggregate of all sample points on which <span class="math inline">\(X\)</span> assumes a fixed value <span class="math inline">\(x_i\)</span> is form the event <span class="math inline">\(X = x_i\)</span>. It’s probability is denoted by <span class="math inline">\(P(X = x_i)\)</span>. The function: <span class="math display">\[\begin{equation*}
P(X = x_i) = p(x_i), \,\, i=1,2,...
\end{equation*}\]</span> is called the <strong>probability distribution</strong> of the random variable <span class="math inline">\(X\)</span>.</p>
<p>where <span class="math inline">\(p(x_i)\)</span> satisfies:</p>
<ul>
<li><span class="math inline">\(0 \leq p(x_i) \leq 1 \,\, \text{for}\,\, i = 1,2, ...\)</span></li>
<li><span class="math inline">\(\sum_{i} p(x_i) = 1\)</span>.</li>
</ul>
</div>
</div>
<p>We can visualize the probability distribution of a discrete random variable using R in a standard example: Consider a random variable <span class="math inline">\(X\)</span> that represents the outcome of rolling a fair six-sided die. The probability distribution is: <span class="math inline">\(P(X = x_i) = \frac{1}{6}, \quad i = 1, 2, 3, 4, 5, 6\)</span>.</p>
<p>This can be visualized as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot bars</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>,<span class="dv">6</span>), <span class="at">type =</span> <span class="st">"h"</span>, </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Probability Distribution"</span>, </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Outcome"</span>, </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Probability"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Add blue filled points at the top of each bar</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>, <span class="dv">6</span>), <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-lecture4_files/figure-html/pmf-visualization-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This plot shows that each outcome has an equal probability of <span class="math inline">\(\frac{1}{6}\)</span> symbolized as a bar. For better readability of the graph we symbolized the function values at <span class="math inline">\(1/6\)</span> by a blue filled dot.</p>
<p>Let me discuss some common confusions that arise often with understanding the concept of a random variable.</p>
<ol type="1">
<li><p><strong>Random Variable vs.&nbsp;Outcome</strong>: A random variable is not the same as an individual outcome. It is a function that assigns values to outcomes. The confusion is partially created by the name. Maybe a better term would be a random mapping. Anyway, keep in mind that a random variable is a function defined on the sample space.</p></li>
<li><p><strong>Probability Distribution vs.&nbsp;Histogram</strong>: A probability distribution represents theoretical probabilities. Don’t mix this concept up with the concept of a histogram, known from statistics and data analysis, which shows frequencies of empirical data.</p></li>
<li><p><strong>Discrete vs.&nbsp;Continuous</strong>: Discrete variables take specific values (e.g., dice outcomes), while continuous variables can take any value in a range. Dealing with continuous variables needs specifc tools which we discuss in lecture 5.</p></li>
</ol>
<div class="callout callout-style-default callout-note callout-titled" title="Now You Try: Other Examples">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Now You Try: Other Examples
</div>
</div>
<div class="callout-body-container callout-body">
<p>Think of scenarios where you could define a discrete random variable.</p>
<p>For instance:</p>
<ul>
<li>The number of defective products in a batch of 20.</li>
<li>The number of rainy days in a week.</li>
</ul>
<p>Simulate and visualize the Probability distribution of these examples in R. You can take the visualization approach we took here. You could also try to make use of R’s <code>barplot()</code> function.</p>
</div>
</div>
<p>A related concept to the probability distribution, is the <strong>cumulative distribution function</strong> (CDF). It can also be used to describe a discrete random variable. The CDF provides the probability that the random variable <span class="math inline">\(X\)</span> takes a value less than or equal to a specific value <span class="math inline">\(x\)</span>:</p>
<div id="cdf-discrete" class="callout callout-style-default callout-tip callout-titled" title="Definition: Cumulative Distribution Function (CDF)">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Definition: Cumulative Distribution Function (CDF)
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <strong>cumulative distribution function</strong> - abbreviated CDF - shows the probability that a random variable <span class="math inline">\(X\)</span> take a value less than or equal to a given value <span class="math inline">\(x_i\)</span>. It is usually denoted as <span class="math inline">\(F(x_i) = P(X \leq x_i)\)</span> where <span class="math inline">\(F\)</span> is non-decreasing and <span class="math inline">\(0 \leq F(x_i) \leq 1\)</span> for <span class="math inline">\(i = 1,2,...\)</span></p>
</div>
</div>
<p>In the case of a discrete random variable the cumulative distribution function (CDF) is a step function, increasing by jump discontinuities. The points where the jumps occur are exactly at the values the random variable can take.</p>
<p>The CDF, <span class="math inline">\(F(x)\)</span>, can be computed in this case as:</p>
<ul>
<li><span class="math inline">\(F(1) = P(X \leq 1) = P(X = 1) = \frac{1}{6}\)</span>,</li>
<li><span class="math inline">\(F(2) = P(X \leq 2) = P(X = 1) + P(X = 2) = \frac{1}{6} + \frac{1}{6} = \frac{2}{6}\)</span>,</li>
<li><span class="math inline">\(F(3) = P(X \leq 3) = \frac{3}{6}\)</span>,</li>
<li>…</li>
<li><span class="math inline">\(F(6) = P(X \leq 6) = \frac{6}{6} = 1\)</span>.</li>
</ul>
<p>The CDF can be visualized as a step function, showing the cumulative probabilities:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>cdf <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>, <span class="dv">6</span>))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the empty plot frame</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">6</span>, <span class="fu">c</span>(<span class="dv">0</span>, cdf), <span class="at">type =</span> <span class="st">"n"</span>, </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Cumulative Distribution Function"</span>, </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Outcome"</span>, </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"F(x)"</span>, </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">6.5</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Draw the first horizontal bar</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">segments</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">"blue"</span>)  <span class="co"># Closed circle at (0, 0)</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="at">pch =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">cex =</span> <span class="fl">1.2</span>)  <span class="co"># Open circle at (1, 0)</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Draw the stepwise CDF</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(x) <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Draw the horizontal bar for each step</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">segments</span>(x[i], cdf[i], x[i <span class="sc">+</span> <span class="dv">1</span>], cdf[i], <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the closed circle at the start of the segment</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(x[i], cdf[i], <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">"blue"</span>)  <span class="co"># Filled circle</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the open circle at the end of the segment</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(x[i <span class="sc">+</span> <span class="dv">1</span>], cdf[i], <span class="at">pch =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">cex =</span> <span class="fl">1.2</span>)  <span class="co"># Open circle</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Draw the last horizontal bar and closed circle at the end</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="fu">segments</span>(<span class="dv">6</span>, cdf[<span class="dv">6</span>], <span class="fl">6.5</span>, cdf[<span class="dv">6</span>], <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="dv">6</span>, cdf[<span class="dv">6</span>], <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">"blue"</span>)  <span class="co"># Closed circle at (6, 1)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-lecture4_files/figure-html/cdf-visualization-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
A Remark on Constructing Complex Graphs in R
</div>
</div>
<div class="callout-body-container callout-body">
<p>This visualization of the cumulative distribution function (CDF) is a great example of how graphs in R can be constructed step by step using layers and overlays. Let’s break it down to understand how the graph is built:</p>
<p>We start with a blank canvas and create an empty plot frame using <code>plot()</code> with <code>type = "n"</code>. The <code>type = "n"</code> argument ensures that no points or lines are drawn initially, allowing us to control exactly what is added to the plot later. This blank canvas defines the axes, labels, and range, providing a foundation for the layers to come.</p>
<p>The first horizontal line is drawn using <code>segments()</code>, starting from <code>(0, 0)</code> to <code>(1, 0)</code>. We add a filled circle (<code>pch = 16</code>) at the start <code>(0, 0)</code> and an open circle (<code>pch = 1</code>) at the end <code>(1, 0)</code> using <code>points()</code>. This step visually initializes the CDF at the correct starting point.</p>
<p>Each step of the CDF is added one at a time using a loop. For each step: - A horizontal line is drawn to represent the constant value of the CDF over that interval. - A closed circle is placed at the beginning of the line to indicate that the value is included in the CDF at that point. - An open circle is added at the end to show that the value is not included yet, highlighting the jump discontinuity.</p>
<p>The final horizontal line is added separately to show the end of the CDF. A closed circle is placed at the end of the last step to signify the inclusion of the final value in the distribution.</p>
</div>
</div>
<p>Here are some key points to keep in mind when working with cumulative distribution functions (CDFs):</p>
<ul>
<li>The CDF gives cumulative probabilities (<span class="math inline">\(P(X \leq x)\)</span>), not individual probabilities.</li>
<li>The CDF is always non-decreasing and reaches 1 for the largest possible value of <span class="math inline">\(X\)</span>.</li>
<li>The CDF for discrete variables is a step-function with jumps at the values the random variable can take.</li>
</ul>
<p>The concepts of a probability distribution function and cumulative distribution function (CDF) can be extended to more than one random variable. When working with multiple random variables, we are often interested in their <strong>joint distribution</strong>, which describes how they behave together, and <strong>conditional distributions</strong>, which describe how one variable behaves given specific information about another. I discuss here the generalization to two random variables. All of the following discussion generalizes to more than two random variables.</p>
<div id="joint-pmf-discrete" class="callout callout-style-default callout-tip callout-titled" title="Joint Probability Distribution">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Joint Probability Distribution
</div>
</div>
<div class="callout-body-container callout-body">
<p>Consider now two discrete random variables <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> defined on the same sample space and let <span class="math inline">\(x_1,x_2, ...\)</span> and <span class="math inline">\(y_1,y_2,...\)</span> the values which they assume. Let <span class="math inline">\(f(x_i)\)</span> and <span class="math inline">\(g(y_j)\)</span> be the corresponding distribution functions. The aggregate of points in which the two condistions <span class="math inline">\(X=x_i\)</span> and <span class="math inline">\(Y=y_j\)</span> are satisfied forms an event whose probability is denoted by <span class="math display">\[P(X = x_i, Y = y_j) = p(x_i, y_j), \,\, i,j,=1,2,...\]</span> is called the <strong>joint probability distribution</strong> of <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>. where <span class="math inline">\(p(x_i, y_j)\)</span> satisfies:</p>
<ul>
<li><span class="math inline">\(0 \leq p(x_i, y_j) \leq 1\)</span> for <span class="math inline">\(i,j = 1,2, ...\)</span>,</li>
<li><span class="math inline">\(\sum_{i,j} p(x_i, y_j) = 1\)</span> for <span class="math inline">\(i,j=1,2,...\)</span>..</li>
</ul>
</div>
</div>
<p>Let me give an example: Imagine rolling two fair six-sided dice. Let <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> represent the outcomes of the first and second dice, respectively. The joint PMF is: <span class="math display">\[P(X = x_i, Y = y_j) = \frac{1}{36}, \quad x_i, y_j = 1, 2, 3, 4, 5, 6.\]</span></p>
<p>This joint probability distribution captures the probability of every possible pair of outcomes, such as <span class="math inline">\((X = 2, Y = 5)\)</span>.</p>
<p>One visualization tool for two dimensional probability distributions the <strong>heatmap</strong>. The <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> axis of the heat map symbolized the values of <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> whereas the third dimension visualizes the probability of each pair of values <span class="math inline">\((x_i,y_j)\)</span> by a color code. So, for example when the dice are fair we should have a probability of <span class="math inline">\(1/36\)</span> for each basic outcome, so you should see only one uniform color.</p>
<p>To illustrate this visualization concept, imagine an example where the dice are biased and not fair, so the probabilities of outcomes can differ:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the outcomes and probabilities for two biased dice</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>outcomes <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>prob_die1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.25</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>)  <span class="co"># Probabilities for die 1</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>prob_die2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.15</span>, <span class="fl">0.2</span>, <span class="fl">0.25</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>)  <span class="co"># Probabilities for die 2</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the joint PMF as the outer product of the two probability vectors</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>joint_pmf <span class="ot">&lt;-</span> <span class="fu">outer</span>(prob_die1, prob_die2)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a heatmap using the image() function</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, joint_pmf,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"blue"</span>))(<span class="dv">100</span>),</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Outcome of Die 2"</span>,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">"Outcome of Die 1"</span>,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Heatmap of Joint PMF (Two Biased Dice)"</span>,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">axes =</span> <span class="cn">FALSE</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Add axis labels</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">labels =</span> outcomes)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>, <span class="at">at =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">labels =</span> outcomes)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a color legend</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"topright"</span>, </span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend =</span> <span class="fu">round</span>(<span class="fu">seq</span>(<span class="fu">min</span>(joint_pmf), <span class="fu">max</span>(joint_pmf), <span class="at">length.out =</span> <span class="dv">5</span>), <span class="dv">3</span>),</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"blue"</span>))(<span class="dv">5</span>),</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Probability"</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-lecture4_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here you see immediately that something is fishy with the dice. Would the dice be fair there should be a uniform color all over the heatmap with a color at the value of <span class="math inline">\(1/36\)</span> or <span class="math inline">\(0.03\)</span>. Try it!</p>
<p>With this notation we can also define the notion of a conditional probability for discrete random variables.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Definition: Conditional Probability">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Definition: Conditional Probability
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <strong>conditional probability</strong> of an event <span class="math inline">\(Y=y_j\)</span>, given <span class="math inline">\(X=x_i\)</span> with <span class="math inline">\(f(x_i) &gt; 0\)</span> is defined as <span class="math display">\[
P(Y = y_j | X = x_i) = \frac{p(x_i,y_j)}{f(x_i)}
\]</span></p>
</div>
</div>
<p>In this way a number is associated with every value of <span class="math inline">\(X\)</span> and so defines a function on <span class="math inline">\(X\)</span>. This function is called</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Definition: Conditional Distribution">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Definition: Conditional Distribution
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <strong>conditional distribution</strong> of <span class="math inline">\(Y\)</span> for given <span class="math inline">\(X\)</span> and denoted by <span class="math display">\[
P(Y = y_j|X)
\]</span></p>
</div>
</div>
<p>Let’s note a few improtant points about conditional distributions:</p>
<ol type="1">
<li>In general, the conditional probability distribution of <span class="math inline">\(Y\)</span> given <span class="math inline">\(X = x_i\)</span> (denoted <span class="math inline">\(p(y_j \mid x_i)\)</span>) differs from the marginal probability distribution <span class="math inline">\(g(y_j)\)</span>. This means that knowing the value of <span class="math inline">\(X\)</span> provides information about <span class="math inline">\(Y\)</span>, which indicates stochastic dependence between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>. The strongest form of dependence occurs when <span class="math inline">\(Y\)</span> is a deterministic function of <span class="math inline">\(X\)</span>, i.e., <span class="math inline">\(Y = h(X)\)</span> for some function <span class="math inline">\(h\)</span>. In this case, <span class="math inline">\(X\)</span> completely determines <span class="math inline">\(Y\)</span>, and their relationship is entirely predictable.</li>
</ol>
<p>On the other hand, if the joint probability distribution <span class="math inline">\(p(x_i, y_j)\)</span> factorizes as: <span class="math display">\[
p(x_i, y_j) = f(x_i) g(y_j) \quad \text{for all pairs } (x_i, y_j),
\]</span> then <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are <strong>independent</strong>. This implies that the occurrence of one event (e.g., <span class="math inline">\(X = x_i\)</span>) has no influence on the probability of the other (e.g., <span class="math inline">\(Y = y_j\)</span>). The joint distribution in this case takes the form of a multiplication table, where the probabilities are products of the marginal probabilities. When <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are independent, their interaction is minimal, and no inference can be drawn about one variable from the other.</p>
<ol start="2" type="1">
<li><p>The joint distribution <span class="math inline">\(p(x_i, y_j)\)</span> uniquely determines the marginal distributions <span class="math inline">\(f(x_i)\)</span> and <span class="math inline">\(g(y_j)\)</span>, as these can be computed by summing over the appropriate dimensions: <span class="math display">\[
f(x_i) = \sum_j p(x_i, y_j), \quad g(y_j) = \sum_i p(x_i, y_j).
\]</span> However, the reverse is not true: the marginal distributions <span class="math inline">\(f(x_i)\)</span> and <span class="math inline">\(g(y_j)\)</span> alone do not determine the joint distribution <span class="math inline">\(p(x_i, y_j)\)</span>. For example, different joint distributions can have the same marginals but encode different types of dependence or independence between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>.</p></li>
<li><p>Note that two random variables <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> can have the same marginal distribution <span class="math inline">\(f(x_i) = g(y_j)\)</span> but may or may not be independent. For instance:</p></li>
</ol>
<ul>
<li>If <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are independent, their joint distribution will factorize as described earlier.</li>
<li>If <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are dependent, their joint distribution will include nontrivial interactions between the variables.</li>
</ul>
<p>At this stage it might be a good idea to recall the example on structured finance from lecture 3. The random variables hidden in this example are default indicators <span class="math inline">\(X\)</span> for bond 1 and <span class="math inline">\(Y\)</span> with <span class="math inline">\(X: \{D,N\} \mapsto \{0,1\}\)</span> and <span class="math inline">\(Y: \{D,N\} \mapsto \{0,1\}\)</span></p>
<p>In the case of <em>independence</em> we had a contingency table like this:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Marginal probabilities for B_1</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>P_N <span class="ot">&lt;-</span> <span class="fl">0.9</span>  <span class="co"># Probability that B_1 does not default</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>P_D <span class="ot">&lt;-</span> <span class="fl">0.1</span>  <span class="co"># Probability that B_1 defaults</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Conditional probabilities for B_2 given B_1</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>P_N_given_N <span class="ot">&lt;-</span> <span class="fl">0.81</span>  <span class="co"># Probability that B_2 does not default given B_1 does not default</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>P_D_given_N <span class="ot">&lt;-</span> <span class="fl">0.09</span>   <span class="co"># Probability that B_2 defaults given B_1 does not default</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>P_N_given_D <span class="ot">&lt;-</span> <span class="fl">0.09</span>    <span class="co"># Probability that B_2 does not default given B_1 defaults</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>P_D_given_D <span class="ot">&lt;-</span> <span class="fl">0.01</span>    <span class="co"># Probability that B_2 defaults given B_1 defaults</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary library</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Define marginal probabilities</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>P_N_total <span class="ot">&lt;-</span> P_N</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>P_D_total <span class="ot">&lt;-</span> P_D</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>P_N_given_total <span class="ot">&lt;-</span> <span class="fu">round</span>(P_N_given_N <span class="sc">+</span> P_D_given_N,<span class="dv">2</span>)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>P_D_given_total <span class="ot">&lt;-</span> <span class="fu">round</span>(P_N_given_D <span class="sc">+</span> P_D_given_D,<span class="dv">2</span>)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the contingency table</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>contingency_table <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    P_D_given_D, P_D_given_N, P_D_total,    <span class="co"># Row 1: Bond 1 Default</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    P_N_given_D, P_N_given_N, P_N_total,    <span class="co"># Row 2: Bond 1 No Default</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    P_D_given_total, P_N_given_total, <span class="dv">1</span>  <span class="co"># Row 3: Column totals</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">3</span>,</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">byrow =</span> <span class="cn">TRUE</span>,</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimnames =</span> <span class="fu">list</span>(</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"Bond 1: Default (D)"</span>, <span class="st">"Bond 1: No Default (N)"</span>, <span class="st">"Total"</span>),</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"Bond 2: Default (D)"</span>, <span class="st">"Bond 2: No Default (N)"</span>, <span class="st">"Total"</span>)</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a styled table</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>kable_output <span class="ot">&lt;-</span> knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>  contingency_table,</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Contingency Table of Joint and Marginal Probabilities: Independence"</span>,</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">format =</span> <span class="st">"html"</span>,</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">escape =</span> <span class="cn">FALSE</span>,</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"Default (D)"</span>, <span class="st">"No Default (N)"</span>, <span class="st">"Total"</span>)</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">column_spec</span>(<span class="dv">1</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Render the table</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>kable_output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Contingency Table of Joint and Marginal Probabilities: Independence</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Default (D)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">No Default (N)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Bond 1: Default (D)</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0.1</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">Bond 1: No Default (N)</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0.81</td>
<td style="text-align: right;">0.9</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Total</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.90</td>
<td style="text-align: right;">1.0</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>The joint probabilities in this case are just the product of the marginal probabilities and the contingency table is similar to a multiplication table.</p>
<p>In the case of <em>dependence</em> this case changes. The new contingency table now looks like this:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary library</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Updated values from the table</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>P_D_given_D <span class="ot">&lt;-</span> <span class="fl">0.06</span>  <span class="co"># Probability that Y defaults given X defaults</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>P_N_given_D <span class="ot">&lt;-</span> <span class="fl">0.04</span>  <span class="co"># Probability that Y does not default given X defaults</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>P_D_given_N <span class="ot">&lt;-</span> <span class="fl">0.04</span>  <span class="co"># Probability that Y defaults given X does not default</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>P_N_given_N <span class="ot">&lt;-</span> <span class="fl">0.86</span>  <span class="co"># Probability that Y does not default given X does not default</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>P_D_total <span class="ot">&lt;-</span> <span class="fl">0.1</span>     <span class="co"># Marginal probability that Y defaults</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>P_N_total <span class="ot">&lt;-</span> <span class="fl">0.9</span>     <span class="co"># Marginal probability that Y does not default</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define totals</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>P_D_given_total <span class="ot">&lt;-</span> P_D_given_D <span class="sc">+</span> P_D_given_N</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>P_N_given_total <span class="ot">&lt;-</span> P_N_given_D <span class="sc">+</span> P_N_given_N</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the contingency table</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>contingency_table <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    P_D_given_D, P_D_given_N, P_D_total,    <span class="co"># Row 1: X Default</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    P_N_given_D, P_N_given_N, P_N_total,    <span class="co"># Row 2: X No Default</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    P_D_given_total, P_N_given_total, <span class="dv">1</span>     <span class="co"># Row 3: Column totals</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">3</span>,</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">byrow =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimnames =</span> <span class="fu">list</span>(</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"X: Default (d)"</span>, <span class="st">"X: No Default (n)"</span>, <span class="st">"Total"</span>),</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"Y: Default (d)"</span>, <span class="st">"Y: No Default (n)"</span>, <span class="st">"Total"</span>)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a styled table</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>kable_output <span class="ot">&lt;-</span> knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  contingency_table,</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Contingency Table of Joint and Marginal Probabilities: Dependence"</span>,</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">format =</span> <span class="st">"html"</span>,</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">escape =</span> <span class="cn">FALSE</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">column_spec</span>(<span class="dv">1</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Render the table</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>kable_output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Contingency Table of Joint and Marginal Probabilities: Dependence</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Y: Default (d)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Y: No Default (n)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">X: Default (d)</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.1</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">X: No Default (n)</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.86</td>
<td style="text-align: right;">0.9</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Total</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.90</td>
<td style="text-align: right;">1.0</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Note that in both cases the marginal probabilities look the same. So in the case of structured finance, a superficial analysis looking at each bond in isolation and <em>assuming</em> independence might make a fatally wrong risk asessment.</p>
<p>For instance, consider <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> that both represent the outcomes of rolling two fair dice. If <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are independent, the joint probabilities <span class="math inline">\(p(x_i, y_j)\)</span> will simply be products of the marginal probabilities. However, if <span class="math inline">\(X = Y\)</span> (e.g., the two dice always show the same value), the joint distribution will reflect perfect dependence, and <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are no longer independent despite having identical marginal distributions.</p>
<p>Here is a visualization of this situation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a joint PMF for dependent dice: one die matches the other</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>outcomes <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>joint_pmf <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">6</span>)  <span class="co"># Probability of matching outcomes is 1/6 for each pair</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create heatmap for the dependent joint PMF</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, joint_pmf,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"blue"</span>))(<span class="dv">100</span>),</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Outcome of Die 2"</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">"Outcome of Die 1"</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Heatmap of Joint PMF (Dependent Dice)"</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">axes =</span> <span class="cn">FALSE</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">labels =</span> outcomes)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>, <span class="at">at =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">labels =</span> outcomes)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a color legend</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"topright"</span>,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend =</span> <span class="fu">round</span>(<span class="fu">seq</span>(<span class="fu">min</span>(joint_pmf), <span class="fu">max</span>(joint_pmf), <span class="at">length.out =</span> <span class="dv">5</span>), <span class="dv">3</span>),</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"blue"</span>))(<span class="dv">5</span>),</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Probability"</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-lecture4_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Keep in mind:</p>
<ul>
<li><strong>Joint Distributions</strong> describe how two random variables behave together.</li>
<li><strong>Conditional Distributions</strong> refine our understanding of one variable based on information about another.</li>
<li>Joint PMFs naturally generalize to describe both <strong>independent</strong> and <strong>dependent</strong> random variables. For dependent variables, the joint PMF captures the interaction and dependencies between the variables, often requiring <strong>conditional probabilities</strong> to explain the relationships.</li>
<li>These concepts are foundational for understanding dependencies in financial modeling, such as asset correlations or portfolio risk.</li>
</ul>
</section>
<section id="the-binomial-distribution-a-fundamental-model-of-chance" class="level2">
<h2 class="anchored" data-anchor-id="the-binomial-distribution-a-fundamental-model-of-chance">The Binomial Distribution: A Fundamental Model of Chance</h2>
<p>In our very first lecture we modeled the flipping of a fair coin using probability theory and R. When we modeled the coin flip with R and tried to visualize, we flipped the coin many times.</p>
<p>Say we flip the coins 10 times. How many heads do you expect to see? What’s the likelihood of getting exactly three heads? These questions, simple yet profound, are at the heart of the <strong>binomial distribution</strong> —one of the most important and versatile models of a discrete random variable.</p>
<p>The binomial distribution arises whenever we repeat a simple experiment, known as a Bernoulli trial, multiple times under the same conditions. Each trial has two possible outcomes, often labeled as “success” and “failure.” By counting the number of successes in a fixed number of trials, the binomial distribution provides a complete picture of the probabilities associated with all possible outcomes.</p>
<p>But why is the binomial distribution so crucial? For one, it is ubiquitous in applications. From predicting election outcomes to evaluating the reliability of systems and understanding financial risks, the binomial model underpins countless real-world phenomena. More importantly, it serves as a foundational tool for understanding the behavior of discrete random variables, providing a framework to compute probabilities, analyze expectations, and quantify variability.</p>
<p>In this section, we’ll explore the binomial distribution in depth. We’ll derive its probability mass function, visualize its cumulative distribution function, and compute key statistics like the mean and variance. Through this concrete example, you’ll not only solidify your understanding of random variables but also gain a versatile tool for modeling uncertainty in diverse contexts.</p>
</section>
<section id="expected-value-variance-and-standard-error-understanding-random-variables" class="level2">
<h2 class="anchored" data-anchor-id="expected-value-variance-and-standard-error-understanding-random-variables">Expected Value, Variance, and Standard Error: Understanding Random Variables</h2>
<p>In Lecture 1, we flipped a fair coin and asked: “What’s the likelihood of heads? How many heads would we expect in multiple flips?” Now, let’s deepen our understanding by connecting these questions to key concepts in probability: <strong>expected value</strong>, <strong>variance</strong>, and <strong>standard error</strong>.</p>
<p>Consider a single flip of a fair coin. Let’s define a random variable <span class="math inline">\(X\)</span>, where: - <span class="math inline">\(X = 1\)</span> if the coin lands heads (success), - <span class="math inline">\(X = 0\)</span> if the coin lands tails (failure).</p>
<p>This is an example of a <strong>Bernoulli random variable</strong>, the simplest discrete random variable.</p>
<div id="expected-value" class="callout callout-style-default callout-tip callout-titled" title="Definition: Expected value">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Definition: Expected value
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let <span class="math inline">\(X\)</span> be a random variable assuming the values <span class="math inline">\(x_1,x_2,x_3, \dots\)</span> with probabilities <span class="math inline">\(p(x_1), p(x_2), p(x_3), \dots\)</span>. The <strong>expected value</strong> of <span class="math inline">\(X\)</span> is defined by <span class="math display">\[
\mathbb{E}[X] = \sum_{x_i} x_i \cdot p(x_i)
\]</span> provided the series converges absolutely. In this case, we say that <span class="math inline">\(X\)</span> has finite expectation. If <span class="math inline">\(\sum |x_i| p(x_i)\)</span> diverges, we say that <span class="math inline">\(X\)</span> has no finite expectation.</p>
</div>
</div>
<p>It is sometimes convenient - and we have done so repeatedly in this lecture - to interpret probabilities as limits of observable frequencies in repeated, independent random experiments.</p>
<p>This would lead to the following intuitive interpretation of expectation. Let the experiment be repeated <span class="math inline">\(n\)</span> times under identical conditions and denote by <span class="math inline">\(X_1,X_2,...,X_n\)</span> the values of <span class="math inline">\(X\)</span> that were actually observed, then for large <span class="math inline">\(n\)</span> the average of these values should be close to <span class="math inline">\(\mathbb{E}[X]\)</span>.</p>
<p>While the terms <em>mean</em>, <em>average</em> and <em>expectation</em> are synonymous, expectation is usually used in relation to random variables, whereas mean and average is used in relation to empirical data.</p>
<p>Let us compute the expected value of the Bernoulli random variable <span class="math inline">\(X\)</span>: <span class="math display">\[
\mathbb{E}[X] = 1 \cdot p + 0 \cdot (1-p) = p.
\]</span> Thus, the expected value of <span class="math inline">\(X\)</span> is <span class="math inline">\(p\)</span>. For a fair coin (<span class="math inline">\(p = 0.5\)</span>), <span class="math inline">\(\mathbb{E}[X] = 0.5\)</span>. This means that in the long run, half of the flips are expected to result in heads.</p>
<p>While the expected value gives the central tendency, the <strong>variance</strong> quantifies the spread of a random variable’s possible outcomes around its expected value.</p>
<div id="expectde-value" class="callout callout-style-default callout-tip callout-titled" title="Definition: Expected value">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Definition: Expected value
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let <span class="math inline">\(X\)</span> be a random variable assuming the values <span class="math inline">\(x_1,x_2,x_3, ...\)</span> with probabilities <span class="math inline">\(p(x_1), p(x_2, p(x_3), ...\)</span>. The <strong>variance</strong> of <span class="math inline">\(X\)</span> is defined by <span class="math display">\[
\text{Var}(X) = \mathbb{E}[(X - \mathbb{E}[X])^2].
\]</span></p>
</div>
</div>
<p>For discrete random variables, this can be written as: <span class="math display">\[
\text{Var}(X) = \sum_{x_i} (x_i - \mathbb{E}[X])^2 \cdot p(x_i).
\]</span> Let’s look again at how this applies to the Bernoulli variable. For our Bernoulli random variable <span class="math inline">\(X\)</span>, substituting <span class="math inline">\(\mathbb{E}[X] = p\)</span>: <span class="math display">\[
\text{Var}(X) = (1 - p)^2 \cdot p + (0 - p)^2 \cdot (1-p) = p(1-p).
\]</span> For a fair coin (<span class="math inline">\(p = 0.5\)</span>): <span class="math display">\[
\text{Var}(X) = 0.5 \cdot 0.5 = 0.25.
\]</span></p>
<p>The <strong>standard error</strong> (SE) is the square root of the variance: <span class="math display">\[
\text{SE}(X) = \sqrt{\text{Var}(X)}.
\]</span> For our fair coin: <span class="math display">\[
\text{SE}(X) = \sqrt{0.25} = 0.5.
\]</span> The standard error is often more convenient than the variance because it is expressed in the same units as the expected value. It thus gives as a clear sense how much the random variable is spread around the mean in the units of the mean. Here is an example.</p>
<p>Suppose a stock’s daily return, <span class="math inline">\(X\)</span>, is modeled as a random variable with an expected return of 0.002 (0.2%) and a variance of <span class="math inline">\(\text{Var}(X)=0.0004\)</span> (0.04%). The variance is expressed in squared units of the return. While mathematically precise, it is not immediately interpretable because we don’t think of returns in squared terms. The standard error is 0.02 (2%) is expressed in the same units as the return. This tells us that daily returns typically deviate by about 2% from the expected return of 0.2%. This demonstrates why the standard error is often preferred when communicating uncertainty—it translates mathematical variability into a form that aligns with practical understanding.</p>
</section>
<section id="extending-to-the-binomial-random-variable" class="level2">
<h2 class="anchored" data-anchor-id="extending-to-the-binomial-random-variable">Extending to the Binomial Random Variable</h2>
<p>Now let’s build on this foundation. Suppose we flip the coin <span class="math inline">\(n\)</span> times and count the total number of heads. This total is a <strong>binomial random variable</strong> <span class="math inline">\(X\)</span>, with parameters: - <span class="math inline">\(n\)</span>: number of trials, - <span class="math inline">\(p\)</span>: probability of heads.</p>
<div id="binomial-dist" class="callout callout-style-default callout-tip callout-titled" title="Definition: Binomial Random Variable">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Definition: Binomial Random Variable
</div>
</div>
<div class="callout-body-container callout-body">
<p>A <strong>binomial random variable</strong> is a discrete random variable with the <span class="math inline">\(X\)</span> with probability distribution <span class="math display">\[
P(X = k) = \binom{n}{k} p^k (1-p)^{n-k}, \quad k = 0, 1, \dots, n,
\]</span> where <span class="math inline">\(\binom{n}{k}\)</span> is the number of ways to choose <span class="math inline">\(k\)</span> successes in <span class="math inline">\(n\)</span> trials.</p>
</div>
</div>
<p>The outcomes of a binomial random variable can be visualized as a <strong>binomial lattice</strong>. In the following figure <a href="#fig-coin-lattice" class="quarto-xref">Figure&nbsp;1</a> we visualize the case where a coin is tossed twice.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-coin-lattice" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-coin-lattice-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/coin_lattice.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-coin-lattice-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: A binomial lattice
</figcaption>
</figure>
</div>
</div>
</div>
<p>Note that we the order of occurence of Heads and Tails does not matter. We only count how many times they occur. Therefore the sequence <code>HT</code> ends in the same node as <code>TH</code>.</p>
<p>We can compute its expected value and variance of a binomial random variable using what we’ve learned: <span class="math display">\[
\mathbb{E}[X] = n \cdot p, \quad \text{Var}(X) = n \cdot p \cdot (1-p), \quad \text{SE}(X) = \sqrt{n \cdot p \cdot (1-p)}.
\]</span> Let us briefly derive these results from the definitions:</p>
<p>To derive the <strong>expected value</strong> and <strong>variance</strong> of a binomial random variable <span class="math inline">\(X\)</span>, we use the definitions and properties of expectation and variance step-by-step.</p>
<p>A binomial random variable <span class="math inline">\(X\)</span> represents the number of successes in <span class="math inline">\(n\)</span><br>
independent trials, where each trial has:</p>
<ul>
<li>Probability of success: <span class="math inline">\(p\)</span>,</li>
<li>Probability of failure: <span class="math inline">\(1 - p\)</span>.</li>
</ul>
<p>The probability density function of <span class="math inline">\(X\)</span> is given by: <span class="math display">\[
P(X = k) = \binom{n}{k} p^k (1-p)^{n-k}, \quad k = 0, 1, 2, \dots, n.
\]</span> The expected value is defined as: <span class="math display">\[
\mathbb{E}[X] = \sum_{k=0}^n k \cdot P(X = k).
\]</span></p>
<p>Substituting: <span class="math display">\[
\mathbb{E}[X] = \sum_{k=0}^n k \cdot \binom{n}{k} p^k (1-p)^{n-k}.
\]</span> The binomial random variable <span class="math inline">\(X\)</span> can be viewed as the sum of <span class="math inline">\(n\)</span> independent Bernoulli random variables <span class="math inline">\(X_i\)</span>, where each <span class="math inline">\(X_i\)</span> is 1 for success and 0 for failure. That is: <span class="math display">\[
X = \sum_{i=1}^n X_i,
\]</span> where <span class="math inline">\(\mathbb{E}[X_i] = p\)</span>.</p>
<p>By the <strong>linearity of expectation</strong>: <span class="math display">\[
\mathbb{E}[X] = \mathbb{E}\left[\sum_{i=1}^n X_i\right] = \sum_{i=1}^n \mathbb{E}[X_i] = n \cdot p.
\]</span> The variance of <span class="math inline">\(X\)</span> is defined as: <span class="math display">\[
\text{Var}(X) = \mathbb{E}[X^2] - (\mathbb{E}[X])^2.
\]</span> We know <span class="math inline">\(X = \sum_{i=1}^n X_i\)</span>. Using the property of variance for independent random variables: <span class="math display">\[
\text{Var}(X) = \text{Var}\left(\sum_{i=1}^n X_i\right) = \sum_{i=1}^n \text{Var}(X_i).
\]</span></p>
<p>For a Bernoulli random variable <span class="math inline">\(X_i\)</span>: <span class="math display">\[
\text{Var}(X_i) = \mathbb{E}[X_i^2] - (\mathbb{E}[X_i])^2.
\]</span></p>
<p>Since <span class="math inline">\(X_i\)</span> takes values 0 and 1: <span class="math display">\[
X_i^2 = X_i, \quad \text{so } \mathbb{E}[X_i^2] = \mathbb{E}[X_i] = p.
\]</span></p>
<p>Thus: <span class="math display">\[
\text{Var}(X_i) = p - p^2 = p(1-p).
\]</span></p>
<p>Now summing over all <span class="math inline">\(n\)</span> trials: <span class="math display">\[
\text{Var}(X) = \sum_{i=1}^n \text{Var}(X_i) = n \cdot p(1-p).
\]</span></p>
<p>For <span class="math inline">\(n = 10\)</span>, <span class="math inline">\(p = 0.5\)</span>: <span class="math display">\[
\mathbb{E}[X] = 10 \cdot 0.5 = 5, \quad \text{Var}(X) = 10 \cdot 0.5 \cdot 0.5 = 2.5, \quad \text{SE}(X) = \sqrt{2.5} \approx 1.58.
\]</span></p>
<p>To solidify these concepts, let’s compute and visualize the probability distribution of a binomial random variable for <span class="math inline">\(n = 10\)</span>, <span class="math inline">\(p = 0.5\)</span>. This shows the probabilities of obtaining 0, 1, 2, …, 10 heads.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R Code to Compute and Plot PMF</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span>n</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>pmf <span class="ot">&lt;-</span> <span class="fu">dbinom</span>(k, <span class="at">size =</span> n, <span class="at">prob =</span> p)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(k, pmf, <span class="at">type =</span> <span class="st">"h"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">main =</span> <span class="st">"PMF of Binomial(20, 0.5)"</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Number of Heads (k)"</span>, <span class="at">ylab =</span> <span class="st">"P(X = k)"</span>, <span class="at">col =</span> <span class="st">"black"</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(k, pmf, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-lecture4_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Key Observations</strong>: - The probability density function is symmetric around the expected value <span class="math inline">\(\mathbb{E}[X] = 10\)</span> because <span class="math inline">\(p = 0.5\)</span>. - The spread is captured by the variance and standard error, with most probabilities concentrated around the mean. The standard error is 2.2</p>
<p>The <strong>binomial distribution</strong> shows the power and versatility of the basic coin model we introduced right at the beginning of this course. It is the basic building block of this distribution and is very powerful in modeling simple experiments and deriving key properties: - <strong>Expected value</strong> provides the long-run average. - <strong>Variance</strong> and <strong>standard error</strong> measure variability. - The PMF describes the probabilities of all possible outcomes.</p>
<p>These concepts form the foundation for understanding random variables and their distributions, bridging theory and real-world applications.</p>
</section>
<section id="covariance" class="level2">
<h2 class="anchored" data-anchor-id="covariance">Covariance</h2>
<p>When we have more than one random variable we can summarize how they vary together. The concept that does this for us is <strong>covariance</strong>. Here is the definition:</p>
<div id="covariance" class="callout callout-style-default callout-tip callout-titled" title="Definition: Covariance">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Definition: Covariance
</div>
</div>
<div class="callout-body-container callout-body">
<p>The covaraince of two random variables <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> is defined by <span class="math display">\[
\text{Cov}(X,Y) = \mathbb{E}(X - \mathbb{E}[X])(Y-\mathbb{E}[Y])
\]</span> Alternatively we can write <span class="math display">\[
\text{Cov}(X,Y) = \mathbb{E}[XY] - \mathbb{E}[X]\mathbb{E}[Y]
\]</span> This definition is meaningful whenever <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> have finite variance.</p>
</div>
</div>
<p>Note the following key points about covariance:</p>
<p>-If <span class="math inline">\(\text{Cov}(X,Y)&gt;0\)</span>: <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> tend to increase together (positive relationship).</p>
<p>-If <span class="math inline">\(\text{Cov}(X,Y)&lt;0\)</span>: <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> tend to move in opposite directions (negative relationship).</p>
<p>-If <span class="math inline">\(\text{Cov}(X,Y)=0\)</span>: <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are linearly uncorrelated, though they may still have a nonlinear relationship.</p>
<p>Covariance is often referred to as a <em>linear</em> measure of dependence. What does this mean? Covariance quantifies how the deviations of <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> from their respective means are aligned. If <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> tend to deviate in the same direction (both above or below their means), the product <span class="math inline">\((X - \mathbb{E}[X])(Y - \mathbb{E}[Y])\)</span> will typically be positive, leading to a positive covariance. Conversely, if they deviate in opposite directions, this product will typically be negative, leading to a negative covariance.</p>
<p>Covariance captures only <strong>linear relationships</strong> because it measures the degree to which <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> co-vary in a straight-line manner. If <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are related nonlinearly (e.g., quadratic, exponential), their covariance might still be zero even though a relationship exists.</p>
<p>Here’s an example to visualize covariance using two binomially distributed random variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulating two binomial random variables</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">10</span>, <span class="at">prob =</span> <span class="fl">0.5</span>)  <span class="co"># Binomial(n=10, p=0.5)</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> X <span class="sc">+</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">10</span>, <span class="at">prob =</span> <span class="fl">0.3</span>)  <span class="co"># Dependent variable</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Covariance</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>cov_xy <span class="ot">&lt;-</span> <span class="fu">cov</span>(X, Y)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatterplot with regression line</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(X, Y, <span class="at">main =</span> <span class="st">"Scatterplot of X and Y with Regression Line"</span>,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"X (Binomial Random Variable)"</span>, <span class="at">ylab =</span> <span class="st">"Y (Dependent Variable)"</span>,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="fu">rgb</span>(<span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.6</span>))</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(Y <span class="sc">~</span> X), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)  <span class="co"># Add regression line</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">paste</span>(<span class="st">"Covariance ="</span>, <span class="fu">round</span>(cov_xy, <span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-lecture4_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here is what this visualization shows:</p>
<ul>
<li>The scatterplot shows the relationship between <span class="math inline">\(X\)</span> (independent binomial variable) and <span class="math inline">\(Y\)</span> (a dependent binomial variable).</li>
<li>The points are scattered around a straight line, which indicates a general linear trend. Covariance quantifies how well the variations in <span class="math inline">\(X\)</span> align with those in <span class="math inline">\(Y\)</span>.</li>
<li>The red line is added to highlight the linear relationship between the two variables.
<ul>
<li>If the covariance is large (positive or negative), the points will cluster more tightly around this line, indicating a stronger linear alignment.</li>
<li>If covariance is close to zero, the scatterplot will show a diffuse cloud of points with no clear linear trend.</li>
</ul></li>
</ul>
<p>Covariance describes only the linear component of the relationship. If <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> have a nonlinear dependency, the scatterplot may show a pattern (e.g., a curve) that the regression line and covariance fail to capture.</p>
<p>Covariance is not a good measure of dependence when the relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> is nonlinear.</p>
<p>For example, if <span class="math inline">\(Y = X^2\)</span>, <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> exhibit a strong quadratic relationship, but their covariance might be close to zero because the deviations <span class="math inline">\((X - \mathbb{E}[X])\)</span> and <span class="math inline">\((Y - \mathbb{E}[Y])\)</span> do not align linearly.</p>
<p>Here is again a visualization:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulating a stronger nonlinear relationship with binomial random variables</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">10</span>, <span class="at">prob =</span> <span class="fl">0.5</span>)  <span class="co"># Binomial(n=10, p=0.5)</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> (X <span class="sc">-</span> <span class="dv">5</span>)<span class="sc">^</span><span class="dv">2</span>  <span class="co"># Pronounced U-shaped relationship</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Covariance</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>cov_xy <span class="ot">&lt;-</span> <span class="fu">cov</span>(X, Y)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatterplot with LaTeX-style labels</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(X, Y, <span class="at">main =</span> <span class="fu">expression</span>(<span class="st">"Scatterplot of "</span> <span class="sc">*</span> Y <span class="sc">==</span> (X <span class="sc">-</span> <span class="dv">5</span>)<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="fu">expression</span>(X <span class="sc">~</span> <span class="st">"(Binomial Random Variable)"</span>),</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="fu">expression</span>(Y <span class="sc">~</span> <span class="st">"= (X - 5)^2"</span>),</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="fu">rgb</span>(<span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.6</span>))</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(Y <span class="sc">~</span> X), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)  <span class="co"># Add regression line</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">paste</span>(<span class="st">"Covariance ="</span>, <span class="fu">round</span>(cov_xy, <span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-lecture4_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>To capture nonlinear dependence, measures like the <strong>mutual information</strong> or a <strong>rank correlation coefficient</strong> (e.g., Spearman’s or Kendall’s) are more appropriate.</p>
<p>By understanding the limitations of covariance, we can use it effectively for its intended purpose while recognizing when other tools are needed to describe more complex relationships.</p>
</section>
<section id="variance-of-the-sum-of-random-variables" class="level2">
<h2 class="anchored" data-anchor-id="variance-of-the-sum-of-random-variables">Variance of the Sum of Random Variables</h2>
<p>The variance of the sum of two random variables, <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, is a natural place where covariance arises. Let’s explore why this happens.</p>
<p>For two random variables <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, the variance of their sum is: <span class="math display">\[
\text{Var}(X + Y) = \text{Var}(X) + \text{Var}(Y) + 2 \cdot \text{Cov}(X, Y).
\]</span></p>
<p>Why does Covariance appear here? When adding <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, the variance accounts not only for the individual variances of <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, but also for how they interact.</p>
<p>The term <span class="math inline">\(2 \cdot \text{Cov}(X, Y)\)</span> reflects this interaction: - If <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are positively correlated, the variability of their sum increases. - If <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are negatively correlated, it decreases.</p>
<p>This property reflects a basic principle of insurance: Diversification reduces risk. In an insurance pool, risks (e.g., claims or losses) that are negatively correlated—or at least uncorrelated—reduce the overall variability of total claims. When risks are positively correlated (e.g., claims rise simultaneously due to shared external factors like natural disasters), the total risk increases, making diversification less effective. By managing correlation, insurers aim to stabilize payouts and maintain predictability.</p>
<p>Consider independent variables as a special case: If <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are independent, <span class="math inline">\(\text{Cov}(X, Y) = 0\)</span>, and the formula simplifies: <span class="math display">\[
\text{Var}(X + Y) = \text{Var}(X) + \text{Var}(Y).
\]</span></p>
<p>As an example let’s go back to our previous case of tossing two coins:</p>
<p><strong>Example: Two Coin Tosses</strong>: Let <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> represent the outcomes of two coin tosses (<span class="math inline">\(X, Y = 1\)</span> for heads, <span class="math inline">\(0\)</span> for tails).</p>
<ul>
<li><strong>Case 1: Independent Tosses</strong>
<ul>
<li>Variance of each toss: <span class="math display">\[
\text{Var}(X) = p(1-p), \quad \text{Var}(Y) = p(1-p).
\]</span></li>
<li>Covariance: <span class="math display">\[
\text{Cov}(X, Y) = 0.
\]</span></li>
<li>Variance of the sum: <span class="math display">\[
\text{Var}(X + Y) = \text{Var}(X) + \text{Var}(Y) = 2p(1-p).
\]</span></li>
</ul></li>
<li><strong>Case 2: Dependent Tosses</strong>
<ul>
<li>Suppose <span class="math inline">\(P(Y = 1 \mid X = 1) = 0.7\)</span> and <span class="math inline">\(P(Y = 1 \mid X = 0) = 0.3\)</span>.</li>
<li>In this case, <span class="math inline">\(\text{Cov}(X, Y) &gt; 0\)</span>, and the variance of <span class="math inline">\(X + Y\)</span> increases due to the positive relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>.</li>
</ul></li>
</ul>
<p>These insights can be extende to more than two random variables. For a sum of <span class="math inline">\(n\)</span> random variables <span class="math inline">\(X_1, X_2, \dots, X_n\)</span>, the variance becomes: <span class="math display">\[
\text{Var}\left(\sum_{i=1}^n X_i\right) = \sum_{i=1}^n \text{Var}(X_i) + \sum_{i \neq j} \text{Cov}(X_i, X_j).
\]</span> This shows how the covariances between pairs of random variables collectively influence the overall variance.</p>
<p>In the special case of identically independently distributed variables we get: If <span class="math inline">\(X_1, X_2, \dots, X_n\)</span> are i.i.d.: <span class="math display">\[
\text{Var}\left(\sum_{i=1}^n X_i\right) = n \cdot \text{Var}(X).
\]</span></p>
</section>
<section id="working-with-the-binomial-distribution-in-r" class="level2">
<h2 class="anchored" data-anchor-id="working-with-the-binomial-distribution-in-r">Working with the Binomial Distribution in R</h2>
<p>R provides built-in functions for working with the binomial distribution. These functions follow a <strong>generic syntax</strong> that is consistent across many other distributions, making them powerful tools for statistical analysis. The key functions are:</p>
<p><strong>d is for the probability density function</strong> The probability distribution gives the probability of observing a specific number of successes in a binomial experiment: <code>dbinom(x, size, prob)</code> with</p>
<ul>
<li><code>x</code>: Number of successes.</li>
<li><code>size</code>: Number of trials (<span class="math inline">\(n\)</span>).</li>
<li><code>prob</code>: Probability of success (<span class="math inline">\(p\)</span>).</li>
</ul>
<p><strong>p is for the cumulative distribution function</strong></p>
<p>The CDF gives the probability of observing up to a certain number of successes: <code>pbinom(x, size, prob)</code> with</p>
<ul>
<li><code>x</code>: Upper limit of the number of successes.</li>
<li><code>size</code>: Number of trials (<span class="math inline">\(n\)</span>).</li>
<li><code>prob</code>: Probability of success (<span class="math inline">\(p\)</span>).</li>
</ul>
<p><strong>q is for the quantile function</strong></p>
<p>The quantile function computes the smallest number of successes for which the cumulative probability exceeds a specified value: <code>qbinom(p, size, prob)</code> with</p>
<ul>
<li><code>p</code>: Cumulative probability.</li>
<li><code>size</code>: Number of trials (<span class="math inline">\(n\)</span>).</li>
<li><code>prob</code>: Probability of success (<span class="math inline">\(p\)</span>).</li>
</ul>
<p><strong>r is for random number generation</strong></p>
<p>This function generates random samples from the binomial distribution: <code>rbinom(n, size, prob)</code> with</p>
<ul>
<li><code>n</code>: Number of random values to generate.</li>
<li><code>size</code>: Number of trials (<span class="math inline">\(n\)</span>).</li>
<li><code>prob</code>: Probability of success (<span class="math inline">\(p\)</span>).</li>
</ul>
<p>R uses a generic accross different distributions: The <code>d</code>, <code>p</code>, <code>q</code>, and <code>r</code> prefixes used in these functions are part of a generic framework in R:</p>
<ul>
<li><code>d</code> for density/PMF.</li>
<li><code>p</code> for cumulative probability (CDF).</li>
<li><code>q</code> for quantiles.</li>
<li><code>r</code> for random number generation.</li>
</ul>
<p>This structure is consistent across other distributions in R, such as the normal (dnorm, pnorm, qnorm, rnorm) or Poisson (dpois, ppois, qpois, rpois) distributions. Understanding this generic syntax simplifies working with various probability distributions.</p>
</section>
<section id="programming-in-r-the-binomial-lattic-model" class="level2">
<h2 class="anchored" data-anchor-id="programming-in-r-the-binomial-lattic-model">Programming in R: The binomial lattic model</h2>
<p>The <strong>binomial lattice model</strong> is a simple yet powerful framework for simulating asset price dynamics under uncertainty. It is widely used in financial modeling, particularly in pricing derivative securities like options, as it captures the probabilistic nature of price movements in discrete time. At each time step, an asset can either move up or down by a specified factor, creating a lattice of possible price paths. It is an excellent application case for discrete random variables but alos for an introduction to writing more complex programs in R.</p>
<p>In this lecture, we will apply the binomial lattice model to simulate the dynamics of a stock index, such as the S&amp;P 500. This example provides a practical use case to reinforce programming concepts while exploring a key tool in financial mathematics.</p>
<p>You will learn how to: - Write more complex R programs, including functions for creating and exploring the lattice. - Use control structures like loops (<code>for</code>, <code>while</code>, <code>repeat</code>) and conditional statements (<code>if</code>, <code>else</code>). - Understand and leverage R’s powerful <strong>list structure</strong> for organizing and manipulating data. - Apply modular programming principles to write reusable, maintainable code.</p>
<p>By the end of this session, you’ll not only have a deeper understanding of the binomial lattice model but also the computational tools to extend this approach to more complex scenarios in financial modeling.</p>
</section>
<section id="the-binomial-lattice-model" class="level2">
<h2 class="anchored" data-anchor-id="the-binomial-lattice-model">The binomial lattice model</h2>
<p>To define the binomia lattice model, we need to establish a basic period length, say 1 week. The model describes a situation where we know the price at the beginning of the period. The price at the beginning of the next period is one of only two possible values. Usually these possibilities are defined as multiples of the price in the previous period, a multiple <span class="math inline">\(u\)</span> (for up) and <span class="math inline">\(d\)</span> (for down). Both <span class="math inline">\(u\)</span> and <span class="math inline">\(d\)</span> are positive with <span class="math inline">\(u &gt; 1\)</span> and <span class="math inline">\(d &lt; 1\)</span>. Hence when the price at the beginning of the period is <span class="math inline">\(S\)</span>, it will be <span class="math inline">\(uS\)</span> or <span class="math inline">\(dS\)</span> at the beginning of the next period. The probabilities of these outcomes are given by <span class="math inline">\(p\)</span> and <span class="math inline">\(1-p\)</span>. This model continues for several periods.</p>
<p>By now you will recognize that the outcomes of this model will be well described by a binomial random variable. The model is equivalent to tossing a coin multiple times.</p>
<p>This binomial lattice model is fundamentally linked to the binomial distribution. Consider the price after <span class="math inline">\(n\)</span> periods. Each period represents a trial where the price either moves up (<span class="math inline">\(u\)</span>) or down (<span class="math inline">\(d\)</span>), with probabilities <span class="math inline">\(p\)</span> and <span class="math inline">\(1−p\)</span>, respectively. The total price after <span class="math inline">\(n\)</span> periods depends on the number of upward movements, denoted by <span class="math inline">\(k\)</span>, and is given by:</p>
<p><span class="math inline">\(S_n = S_0 \times  u^k \times d^{n−k}\)</span>,</p>
<p>where <span class="math inline">\(k\)</span> is the number of “up” movements and <span class="math inline">\(n−k\)</span> is the number of “down” movements.</p>
<p>The distribution of <span class="math inline">\(k\)</span> follows a binomial distribution: <span class="math display">\[
P(k) = \binom{n}{k} p^k (1-p)^{n-k}, \quad k = 0, 1, 2, \dots, n
\]</span> which describes the likelihood of observing <span class="math inline">\(k\)</span> upward movements out of <span class="math inline">\(n\)</span> trials.</p>
<p>This model may seem too simplistic for describing the price dynamics of a stock index, because there are only two possible outcomes per period.</p>
<p>But when you make the connection to and the the binomial distribution you will realize how this restriction becomes less severe when <span class="math inline">\(\Delta t\)</span> the time steps are small: the random variable <span class="math inline">\(k\)</span>, representing the count of up movements, directly determines the p ossible price levels of the asset.</p>
<p>Over many periods <span class="math inline">\(n\)</span>, this simple two-step structure generates a range of prices consistent with the binomial distribution. This relationship also explains why the model becomes increasingly flexible and realistic as the number of periods grows, enabling it to approximate more complex price dynamics.</p>
<p>Because the model is multiplicative, the price will never become negative. We can thus work with the logarithm of the price as our fundamental variable.</p>
<p>Accordinglly, we define <span class="math inline">\(\nu\)</span> as the expected annual growth rate <span class="math display">\[
\nu = \mathbb[\ln(S_T/S_0)]
\]</span> where <span class="math inline">\(S_0\)</span> is the initial stock price and <span class="math inline">\(S_T\)</span> is the price at the end of the year. Likewise we define the variance as <span class="math display">\[
\sigma^2=\text{var}[\ln(S_T/S_0)$]
\]</span></p>
<p>If the period length <span class="math inline">\(\Delta t\)</span> is chosen small compared to 1, the parameters of the binomial lattice can be selected as: <span class="math display">\[\begin{eqnarray}
p &amp;=&amp; \frac{1}{2} + \frac{1}{2}\left(\frac{\nu}{\sigma}\right) \sqrt{\Delta t} \\
u &amp;=&amp; \exp(\sigma \sqrt{\Delta t}) \\
d &amp;=&amp; \exp(- \sigma \sqrt{\Delta t})
\end{eqnarray}\]</span></p>
<section id="modelling-the-dynamics-of-the-sp500" class="level3">
<h3 class="anchored" data-anchor-id="modelling-the-dynamics-of-the-sp500">Modelling the Dynamics of the SP500</h3>
<p>As a use case we make a model which we calibrate to the SP500, a broad stock market index that we have used already before in our lectures. Let#s get the S&amp;P data using the <code>tidyquant</code>package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyquant)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Retrieve S&amp;P 500 data (adjust ticker as needed)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>sp500_data <span class="ot">&lt;-</span> <span class="fu">tq_get</span>(<span class="st">"SPY"</span>, <span class="at">from =</span> <span class="st">"2000-01-01"</span>, <span class="at">to =</span> <span class="st">"2025-01-01"</span>, <span class="at">get =</span> <span class="st">"stock.prices"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract adjusted prices and dates</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>dates <span class="ot">&lt;-</span> sp500_data<span class="sc">$</span>date</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>adjusted_prices <span class="ot">&lt;-</span> sp500_data<span class="sc">$</span>adjusted</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the first trading day of each year</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">format</span>(dates, <span class="st">"%Y"</span>))  <span class="co"># Extract unique years</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>annual_indices <span class="ot">&lt;-</span> <span class="fu">sapply</span>(years, <span class="cf">function</span>(year) {</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">which</span>(<span class="fu">format</span>(dates, <span class="st">"%Y"</span>) <span class="sc">==</span> year)[<span class="dv">1</span>]  <span class="co"># Get the first trading day of the year</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract prices and dates for the first trading day of each year</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>annual_prices <span class="ot">&lt;-</span> adjusted_prices[annual_indices]</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>annual_dates <span class="ot">&lt;-</span> dates[annual_indices]</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute annual log returns</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>log_returns <span class="ot">&lt;-</span> <span class="fu">diff</span>(<span class="fu">log</span>(annual_prices))  <span class="co"># Compute log(S_T / S_0)</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine into a data frame</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>annual_log_returns <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="fu">format</span>(annual_dates[<span class="sc">-</span><span class="dv">1</span>], <span class="st">"%Y"</span>),  <span class="co"># Corresponding years for log returns</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_return =</span> log_returns</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters for weekly time step (1/52 years)</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>delta_t <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">52</span>  <span class="co"># Weekly time step</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="fu">mean</span>(annual_log_returns<span class="sc">$</span>log_return, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)  <span class="co"># Mean log return</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>sigma_squared <span class="ot">&lt;-</span> <span class="fu">var</span>(annual_log_returns<span class="sc">$</span>log_return, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)  <span class="co"># Variance</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sigma_squared)  <span class="co"># Standard deviation</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Calibrate binomial model parameters</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> (nu <span class="sc">/</span> sigma) <span class="sc">*</span> <span class="fu">sqrt</span>(delta_t)</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fu">exp</span>(sigma <span class="sc">*</span> <span class="fu">sqrt</span>(delta_t))</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span>sigma <span class="sc">*</span> <span class="fu">sqrt</span>(delta_t))</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a><span class="co"># View calibrated parameters</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">nu =</span> nu,</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">sigma =</span> sigma,</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">p =</span> p,</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">u =</span> u,</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> d</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>parameters</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$nu
[1] 0.06734657

$sigma
[1] 0.176833

$p
[1] 0.5264071

$u
[1] 1.024825

$d
[1] 0.9757759</code></pre>
</div>
</div>
<p>We retrieve a series of daily prices, extract a series of annual price changes from there and then compute the parameters and pack them into a list. The precise reason why we can calibrate the model like this and why this works, we will see in lecture 5-</p>
</section>
<section id="for-loops-and-lookup-tables-building-the-lattice" class="level3">
<h3 class="anchored" data-anchor-id="for-loops-and-lookup-tables-building-the-lattice">For loops and lookup tables: Building the lattice</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the step number</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the starting price S0 (choose most recent price)</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>S0 <span class="ot">&lt;-</span> adjusted_prices[<span class="fu">length</span>(adjusted_prices)]</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the lattice as a list</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>lattice <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, n <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Build the lattice</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (step <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>n) {</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  prices <span class="ot">&lt;-</span> <span class="fu">numeric</span>(step <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>step) {</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    prices[i <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> S0 <span class="sc">*</span> u<span class="sc">^</span>i <span class="sc">*</span> d<span class="sc">^</span>(step <span class="sc">-</span> i)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  lattice[[step <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> prices</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co"># View the lattice</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>lattice</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 586.08

[[2]]
[1] 571.8828 600.6297

[[3]]
[1] 558.0294 586.0800 615.5406

[[4]]
[1] 544.5117 571.8828 600.6297 630.8217</code></pre>
</div>
</div>
<p>This code snippet uses <strong><code>for</code> loops</strong> and a <strong>lookup table</strong> to build a binomial lattice. Both are important concepts when writing R programs-</p>
<p>Let’s break it down step by step, focusing on the programming concepts involved.</p>
<section id="for-loops-in-r" class="level4">
<h4 class="anchored" data-anchor-id="for-loops-in-r">for` Loops in R**</h4>
<p>A <code>for</code> loop in R iterates over a sequence of values, executing a block of code for each value. Its syntax is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (variable <span class="cf">in</span> sequence) {</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Code to execute in each iteration</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In our code we have two loops: An outer loop <code>for (step in 0:n) {</code>. This loop iterates through each step of the lattice, from <code>0</code> to <code>n</code> (the total number of time steps in the model). The variable <code>step</code> represents the current level of the lattice.</p>
<p>The inner loop <code>for (i in 0:step) {</code>: For each level of the lattice (<code>step</code>), this loop iterates over the possible nodes (prices) at that level. The variable <code>i</code> represents the number of upward moves at this level.</p>
</section>
<section id="lookup-tables" class="level4">
<h4 class="anchored" data-anchor-id="lookup-tables">Lookup tables</h4>
<p>A <strong>lookup table</strong> is a data structure that stores values for quick access, allowing computations to refer to pre-calculated data instead of recomputing it repeatedly.</p>
<p>In this example, the <strong>lattice itself is the lookup table</strong>. It stores the prices at each step and node of the lattice in a list structure:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>  lattice[[step <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> prices</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Each element of <code>lattice</code> corresponds to a time step. <code>lattice[[step + 1]]</code> stores a numeric vector containing all possible prices at the <code>step</code> level of the lattice.</p>
<p>Now here’s how the code uses <code>for</code> loops and a lookup table to build the binomial lattice:</p>
<p>We first initialize the lattice by <code>lattice &lt;- vector("list", n + 1)</code>. A list of size <code>n + 1</code> is created to store the prices for each step of the lattice (from step <code>0</code> to step <code>n</code>). Lists are ideal here because they allow each element to store a vector of prices, with the number of prices varying at each step.</p>
<p>Preallocating space for the output is good practice when writing <code>for</code> loops in R (or any other programming language) because it significantly improves performance and readability. Here’s why: It <strong>avoids repeated memory allocation</strong>: If you grow an object inside a loop (e.g., using <code>c()</code> to append values), R reallocates memory every time the object changes size. This is computationally expensive, especially for large loops. By preallocating the required space, memory is allocated only once, and the values are directly written into the reserved space, saving computation time.</p>
<p>Preallocation makes the structure of the output clear before the loop begins and <strong>improves code readability</strong>. Readers can immediately understand the size and type of the expected result.</p>
<p>Finally it <strong>avoids unnecessary complexity</strong>: Growing objects dynamically can make the code harder to follow and debug.</p>
<p>Preallocation ensures better performance and cleaner, more professional code!</p>
<p>Let’s look closer into what our loops do:</p>
<p>The <strong>Outer Loop</strong>: Iterates over each step of the lattice. At each step, a new vector <code>prices</code> is created to store the prices for that level.</p>
<p>The <strong>Inner Loop</strong> computes the price for each node at the current step. For node <code>i</code>, the price is calculated using: <span class="math display">\[
S_i = S_0 \cdot u^i \cdot d^{\text{step} - i}
\]</span> The result is stored in the <code>prices</code> vector, with indices adjusted for R’s 1-based indexing (<code>i + 1</code>).</p>
<p>After computing all prices for the current step, the <code>prices</code> vector is added to the <code>lattice</code> lookup table at index <code>step + 1</code>.</p>
<p>The final <code>lattice</code> contains all possible prices at each step, structured as a list: - <code>lattice[[1]]</code>: Prices at step 0 (initial price, <code>S0</code>). - <code>lattice[[2]]</code>: Prices at step 1 (two possible prices: up and down). - And so on, up to <code>lattice[[n + 1]]</code>.</p>
</section>
<section id="visualizing-the-lattice" class="level4">
<h4 class="anchored" data-anchor-id="visualizing-the-lattice">Visualizing the lattice</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load ggplot2 library</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for plotting</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Step =</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span>n, <span class="at">times =</span> <span class="fu">seq_len</span>(n <span class="sc">+</span> <span class="dv">1</span>)),  <span class="co"># x-coordinates</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Price =</span> <span class="fu">unlist</span>(lattice),                 <span class="co"># y-coordinates</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Label =</span> <span class="fu">round</span>(<span class="fu">unlist</span>(lattice), <span class="dv">2</span>)        <span class="co"># Labels with rounded prices</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create edges for connections</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>edges <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="cf">function</span>(step) {</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">rep</span>(step <span class="sc">-</span> <span class="dv">1</span>, <span class="at">times =</span> step),           <span class="co"># Starting x-coordinates</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">xend =</span> <span class="fu">rep</span>(step, <span class="at">times =</span> step),           <span class="co"># Ending x-coordinates</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> lattice[[step]],                      <span class="co"># Starting y-coordinates</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">yend =</span> <span class="fu">c</span>(lattice[[step <span class="sc">+</span> <span class="dv">1</span>]][<span class="sc">-</span><span class="dv">1</span>], lattice[[step <span class="sc">+</span> <span class="dv">1</span>]][<span class="sc">-</span><span class="fu">length</span>(lattice[[step <span class="sc">+</span> <span class="dv">1</span>]])]) <span class="co"># Ending y-coordinates</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>}))</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add edges</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> edges, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend),</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"gray"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add nodes</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> plot_data, <span class="fu">aes</span>(<span class="at">x =</span> Step, <span class="at">y =</span> Price), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add price labels</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> plot_data, <span class="fu">aes</span>(<span class="at">x =</span> Step, <span class="at">y =</span> Price, <span class="at">label =</span> Label),</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Enriched Binomial Lattice with Prices for S&amp;P 500"</span>,</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Step"</span>, <span class="at">y =</span> <span class="st">"Price"</span>) <span class="sc">+</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-lecture4_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="flow-control-exploring-the-lattice" class="level3">
<h3 class="anchored" data-anchor-id="flow-control-exploring-the-lattice">Flow Control: Exploring the Lattice</h3>
<p>Use a <code>while</code> loop to traverse the lattice and compute specific properties (e.g., maximum or minimum price).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Traverse lattice to find maximum price</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>max_price <span class="ot">&lt;-</span> <span class="sc">-</span><span class="cn">Inf</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>step <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (step <span class="sc">&lt;=</span> <span class="fu">length</span>(lattice)) {</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  max_price <span class="ot">&lt;-</span> <span class="fu">max</span>(max_price, <span class="fu">max</span>(lattice[[step]]))</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  step <span class="ot">&lt;-</span> step <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>max_price</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 630.8217</code></pre>
</div>
</div>
<p>Use conditional statements to annotate whether a price exceeds a certain threshold.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Annotate prices exceeding 4100</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> <span class="dv">4100</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (step <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>n) {</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(lattice[[step <span class="sc">+</span> <span class="dv">1</span>]])) {</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (lattice[[step <span class="sc">+</span> <span class="dv">1</span>]][i] <span class="sc">&gt;</span> threshold) {</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Price exceeds threshold at step"</span>, step, <span class="st">":"</span>, lattice[[step <span class="sc">+</span> <span class="dv">1</span>]][i]))</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Refactor the code into reusable functions:</p>
<ul>
<li>build_lattice(S0, u, d, n): Creates the binomial lattice.</li>
<li>annotate_lattice(lattice, threshold): Annotates lattice with conditions.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>build_lattice <span class="ot">&lt;-</span> <span class="cf">function</span>(S0, u, d, n) {</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  lattice <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, n <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (step <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>n) {</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    prices <span class="ot">&lt;-</span> <span class="fu">numeric</span>(step <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>step) {</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>      prices[i <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> S0 <span class="sc">*</span> u<span class="sc">^</span>i <span class="sc">*</span> d<span class="sc">^</span>(step <span class="sc">-</span> i)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    lattice[[step <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> prices</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(lattice)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>annotate_lattice <span class="ot">&lt;-</span> <span class="cf">function</span>(lattice, threshold) {</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (step <span class="cf">in</span> <span class="fu">seq_along</span>(lattice)) {</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (price <span class="cf">in</span> lattice[[step]]) {</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (price <span class="sc">&gt;</span> threshold) {</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Price exceeds threshold at step"</span>, step <span class="sc">-</span> <span class="dv">1</span>, <span class="st">":"</span>, price))</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using R Lists</p>
<p>Explain how the list structure allows flexible storage and access to lattice data. Show how lists simplify operations like traversing, annotating, or transforming the lattice.</p>
</section>
</section>
<section id="compare-with-the-binomial-distribution" class="level2">
<h2 class="anchored" data-anchor-id="compare-with-the-binomial-distribution">Compare with the Binomial Distribution</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># number of simulations</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>simulations <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate prices using the binomial lattice</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>simulate_price <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  upward_moves <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="at">size =</span> n, <span class="at">prob =</span> p)  <span class="co"># Simulate number of up moves</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  S0 <span class="sc">*</span> u<span class="sc">^</span>upward_moves <span class="sc">*</span> d<span class="sc">^</span>(n <span class="sc">-</span> upward_moves)     <span class="co"># Compute final price</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>simulated_prices <span class="ot">&lt;-</span> <span class="fu">replicate</span>(simulations, <span class="fu">simulate_price</span>())</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the simulated distribution</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>simulated_data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(simulated_prices))</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(simulated_data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Price"</span>, <span class="st">"Count"</span>)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>simulated_data<span class="sc">$</span>Price <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(simulated_data<span class="sc">$</span>Price))</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>simulated_data<span class="sc">$</span>Probability <span class="ot">&lt;-</span> simulated_data<span class="sc">$</span>Count <span class="sc">/</span> <span class="fu">sum</span>(simulated_data<span class="sc">$</span>Count)</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Binomial distribution for comparison</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>binomial_counts <span class="ot">&lt;-</span> <span class="fu">dbinom</span>(<span class="dv">0</span><span class="sc">:</span>n, <span class="at">size =</span> n, <span class="at">prob =</span> p)  <span class="co"># Theoretical probabilities</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>binomial_prices <span class="ot">&lt;-</span> S0 <span class="sc">*</span> u<span class="sc">^</span>(<span class="dv">0</span><span class="sc">:</span>n) <span class="sc">*</span> d<span class="sc">^</span>(n<span class="sc">:</span><span class="dv">0</span>)           <span class="co"># Prices corresponding to outcomes</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>theoretical_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">Price =</span> binomial_prices,</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">Probability =</span> binomial_counts</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot simulated vs theoretical distribution</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Simulated probabilities as bars</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">data =</span> simulated_data, <span class="fu">aes</span>(<span class="at">x =</span> Price, <span class="at">y =</span> Probability, <span class="at">fill =</span> <span class="st">"Simulated"</span>), </span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">width =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Theoretical probabilities as points</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> theoretical_data, <span class="fu">aes</span>(<span class="at">x =</span> Price, <span class="at">y =</span> Probability, <span class="at">color =</span> <span class="st">"Theoretical"</span>),</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Simulated vs Theoretical Distribution of Binomial Lattice Prices"</span>,</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Price"</span>, <span class="at">y =</span> <span class="st">"Probability"</span>, <span class="at">fill =</span> <span class="st">"Legend"</span>, <span class="at">color =</span> <span class="st">"Legend"</span>) <span class="sc">+</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-lecture4_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="subsection-leveraging-an-llm-to-enhance-learning-from-binomial-models" class="level3">
<h3 class="anchored" data-anchor-id="subsection-leveraging-an-llm-to-enhance-learning-from-binomial-models">Subsection: Leveraging an LLM to Enhance Learning from Binomial Models</h3>
<p>Since this lecture was a lot about programing I would like to show you here as a use case for how the LLM can enhance your learning experience, a case where you can use the LLM to debug your code, taking the binomial lattice example as a case in point.</p>
<p>Debugging is a critical skill when learning to program, and large language models (LLMs) like ChatGPT can serve as valuable assistants in this process. Below is a suggested outline for a subsection demonstrating how you can use an LLM to debug the binomial lattice programming example.</p>
<section id="using-an-llm-to-debug-the-binomial-lattice-example" class="level4">
<h4 class="anchored" data-anchor-id="using-an-llm-to-debug-the-binomial-lattice-example"><strong>Using an LLM to Debug: The Binomial Lattice Example</strong></h4>
<p>When building the binomial lattice, you might encounter issues like incorrect outputs, errors in indexing, or unexpected behavior in your code.</p>
<p>Here’s how an LLM can help:</p>
<p><strong>1. Understanding Error Messages</strong></p>
<p>Here is a typical scenario: Suppose you encounter the error: <code>Error in rep(0:n, times = 1:n + 1) : invalid 'times' argument</code>.</p>
<p>Here is how the LLM helps.</p>
<ul>
<li><p>Ask the LLM for an explanation: &gt; “I encountered the error <code>invalid 'times' argument</code> in R. Here’s the code: <code>rep(0:n, times = 1:n + 1)</code>. What’s wrong?”</p></li>
<li><p>Expected Response:</p>
<ul>
<li>The LLM will explain that <code>1:n + 1</code> is interpreted as <code>(1:n) + 1</code> due to operator precedence and suggest wrapping it in parentheses: <code>times = (1:n) + 1</code>.</li>
</ul></li>
</ul>
<p><strong>2. Fixing Logic Errors</strong></p>
<p>Here is another scenario: Your binomial lattice produces unexpected prices at certain nodes, possibly due to incorrect calculations in the inner loop.</p>
<p>You can use the LLM in the following way in such a scenario:</p>
<ul>
<li><p>Describe the issue to the LLM and share the relevant code snippet: &gt; “My R program for generating a binomial lattice gives wrong prices. Here’s the code for the inner loop:<br>
<code>prices[i + 1] &lt;- S0 * u^i * d^(step - i)</code> What could be wrong?”</p></li>
<li><p>Expected Response:</p>
<ul>
<li>The LLM identifies possible issues, like <code>i</code> or <code>step</code> being out of range or incorrectly calculated, and suggests debugging steps such as printing intermediate values or checking the inputs.</li>
</ul></li>
</ul>
<p><strong>3. Optimizing and Explaining Code</strong></p>
<p>Suppose you want to understand why lists are used for the lattice instead of other data structures.</p>
<p>You can ask the LLM:</p>
<ul>
<li><p>Ask for an explanation: &gt; “Why is a list used to store the binomial lattice in R? Would a matrix or data frame work better?”</p></li>
<li><p>Expected Response:</p>
<ul>
<li>The LLM explains that a list is suitable because each level of the lattice has a variable number of nodes, which isn’t easily handled by a matrix or data frame without introducing unnecessary complexity.</li>
</ul></li>
</ul>
<p><strong>4. Debugging Visualization Issues</strong></p>
<p>Assume you’re trying to plot the lattice, but the <code>geom_segment</code> lines don’t connect the nodes as expected.</p>
<ul>
<li><p>Describe the visualization issue: &gt; “I’m plotting a binomial lattice using <code>geom_segment</code> in ggplot2, but the edges don’t connect the nodes correctly. Here’s my edge-building code:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>edges <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> ..., <span class="at">y =</span> ..., <span class="at">xend =</span> ..., <span class="at">yend =</span> ...)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>What could be wrong?”</p></li>
<li><p>Expected Response:</p>
<ul>
<li>The LLM checks the code logic and might point out mismatches between <code>x</code>, <code>y</code>, <code>xend</code>, and <code>yend</code> or issues with the structure of the <code>edges</code> data frame.</li>
</ul></li>
</ul>
<p><strong>General Tips for Using an LLM for Debugging</strong>:</p>
<ol type="1">
<li><strong>Be Specific</strong>: Clearly describe the problem and provide the relevant code snippet. The more context you provide, the better the assistance.</li>
<li><strong>Iterate</strong>: If the initial response doesn’t fully address your issue, refine your question or provide additional details.</li>
<li><strong>Verify Suggestions</strong>: Test the LLM’s suggestions in your R environment to ensure they solve the problem.</li>
</ol>
</section>
</section>
</section>
<section id="project-portfolio-simulation-and-analysis-with-discrete-random-variables" class="level2">
<h2 class="anchored" data-anchor-id="project-portfolio-simulation-and-analysis-with-discrete-random-variables">Project: Portfolio Simulation and Analysis with Discrete Random Variables</h2>
</section>
<section id="project-overview" class="level2">
<h2 class="anchored" data-anchor-id="project-overview">Project Overview</h2>
<p>In this project, you will simulate and analyze the performance of a portfolio composed of three assets under uncertain economic conditions. You will model the asset returns using discrete random variables, compute key portfolio metrics like expected return and variance, and understand the economic intuition behind portfolio diversification. This project will also reinforce key programming concepts such as modular functions, control structures, and R’s list structure.</p>
</section>
<section id="project-objectives" class="level2">
<h2 class="anchored" data-anchor-id="project-objectives">Project Objectives</h2>
<p>By the end of this project, you should be able to: 1. Apply the concept of random variables to model asset returns under uncertainty. 2. Simulate portfolio performance over multiple periods. 3. Compute and interpret key portfolio metrics: expected return, variance, and covariance. 4. Use modular programming, control structures, and lists in R to build efficient and reusable code. 5. Understand the trade-offs between risk and return in portfolio theory.</p>
</section>
<section id="project-tasks" class="level2">
<h2 class="anchored" data-anchor-id="project-tasks">Project Tasks</h2>
<section id="task-1-define-the-portfolio" class="level3">
<h3 class="anchored" data-anchor-id="task-1-define-the-portfolio">Task 1: Define the Portfolio</h3>
<ol type="1">
<li>Define three economic states: <code>"High"</code>, <code>"Medium"</code>, and <code>"Low"</code>, and their probabilities: 30%, 50%, and 20%.</li>
<li>Assign discrete returns for three assets under each state:
<ul>
<li>Asset 1: <code>c(0.08, 0.04, -0.02)</code></li>
<li>Asset 2: <code>c(0.12, 0.03, -0.05)</code></li>
<li>Asset 3: <code>c(0.05, 0.02, 0.01)</code></li>
</ul></li>
<li>Specify portfolio weights: 50% for Asset 1, 30% for Asset 2, and 20% for Asset 3.</li>
</ol>
</section>
<section id="task-2-simulate-portfolio-performance" class="level3">
<h3 class="anchored" data-anchor-id="task-2-simulate-portfolio-performance">Task 2: Simulate Portfolio Performance</h3>
<ol type="1">
<li>Write modular functions to:
<ul>
<li>Simulate a random economic state based on the given probabilities.</li>
<li>Retrieve asset returns for the simulated state using a list structure.</li>
<li>Compute the portfolio return as the weighted sum of asset returns.</li>
</ul></li>
<li>Simulate portfolio performance over 1,000 periods and store the results in a list. Each element should include:
<ul>
<li>The simulated state.</li>
<li>Returns for each asset.</li>
<li>The portfolio return.</li>
</ul></li>
</ol>
</section>
<section id="task-3-analyze-portfolio-performance" class="level3">
<h3 class="anchored" data-anchor-id="task-3-analyze-portfolio-performance">Task 3: Analyze Portfolio Performance</h3>
<ol type="1">
<li>Compute summary statistics for the simulated portfolio returns:
<ul>
<li>Mean return.</li>
<li>Variance of returns.</li>
</ul></li>
<li>Compare the simulated mean return with the <strong>theoretical expected portfolio return</strong>, calculated as: <span class="math display">\[
E(R_{\text{portfolio}}) = \sum_{i=1}^n w^i \cdot E(r^i)
\]</span></li>
<li>(Optional) Compute the theoretical portfolio variance: <span class="math display">\[
\text{Var}(R_{\text{portfolio}}) = \sum_{i=1}^n (w^i)^2 \cdot \text{Var}(r^i) + \sum_{i \neq j} w^i \cdot w^j \cdot \text{Cov}(r^i, r^j)
\]</span></li>
</ol>
</section>
<section id="task-4-visualize-results" class="level3">
<h3 class="anchored" data-anchor-id="task-4-visualize-results">Task 4: Visualize Results</h3>
<ol type="1">
<li>Create a histogram of the simulated portfolio returns.</li>
<li>Calculate and display the frequency of each economic state in the simulation to verify that the probabilities were correctly implemented.</li>
</ol>
</section>
<section id="task-5-reflection-and-extensions" class="level3">
<h3 class="anchored" data-anchor-id="task-5-reflection-and-extensions">Task 5: Reflection and Extensions</h3>
<ol type="1">
<li>Reflect on the relationship between diversification and risk. How does combining assets with different return profiles reduce portfolio variance?</li>
<li><strong>Extensions (Optional)</strong>:
<ul>
<li>Add a fourth asset to the portfolio and observe its impact on portfolio metrics.</li>
<li>Explore how changing portfolio weights affects expected return and variance.</li>
</ul></li>
</ol>
</section>
</section>
<section id="deliverables" class="level2">
<h2 class="anchored" data-anchor-id="deliverables">Deliverables</h2>
<ol type="1">
<li>Well-documented R script implementing the project tasks.</li>
<li>A short report summarizing:
<ul>
<li>Key findings from the simulation and analysis.</li>
<li>Comparison between simulated and theoretical metrics.</li>
<li>Visualizations (e.g., histogram, state frequencies).</li>
</ul></li>
</ol>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>